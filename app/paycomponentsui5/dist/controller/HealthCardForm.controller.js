sap.ui.define(["qa/com/qelng/pcui5/paycomponentsui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,r,n,i,o){"use strict";let l="";let s={healthCardForm:{}};return e.extend("qa.com.qelng.pcui5.paycomponentsui5.controller.HealthCardForm",{onInit:function(){let e=new t,r=Object.assign({},s);e.setData(r);this.setModel(e);let n=[];for(let e=2024;e<=2100;e++){n.push({year:e})}e.setProperty("/healthCardForm/year",n);let i=this.getOwnerComponent().getModel("pcModel");i.setSizeLimit(5e4)},onAfterRendering:function(){let e=this.getView();let t=e.getModel();this.defaultHealthCardFormBinding(t);this.byId("healthCardForm").bindElement("/healthCardForm")},defaultHealthCardFormBinding(){this.clearListSelection();let e=this.getView().getModel();e.setProperty("/healthCardForm/payComponent","");e.setProperty("/healthCardForm/referenceYear","");e.setProperty("/healthCardForm/userId","");e.setProperty("/healthCardForm/organizationalUnit","");e.setProperty("/healthCardForm/group","");e.setProperty("/healthCardForm/department","");e.setProperty("/healthCardForm/job","");e.setProperty("/healthCardForm/hrPersonnelArea","");e.setProperty("/healthCardForm/employeeGroup","");e.setProperty("/healthCardForm/simulationMode",false);e.setProperty("/healthCardForm/adminEmail","")},resetOnRefYearChange:function(){this.clearListSelection();let e=this.getView().getModel();e.setProperty("/healthCardForm/userId","");e.setProperty("/healthCardForm/organizationalUnit","");e.setProperty("/healthCardForm/group","");e.setProperty("/healthCardForm/department","");e.setProperty("/healthCardForm/job","");e.setProperty("/healthCardForm/hrPersonnelArea","");e.setProperty("/healthCardForm/employeeGroup","");e.setProperty("/healthCardForm/simulationMode",false);e.setProperty("/healthCardForm/adminEmail","")},clearListSelection:function(){let e=this.getView().getModel().getData().healthCardForm;if(e.department){this.byId("departmentList").clearSelection()}if(e.job){this.byId("jobList").clearSelection()}if(e.group){this.byId("groupList").clearSelection()}if(e.organizationalUnit){this.byId("orgUnitList").clearSelection()}if(e.hrPersonnelArea){this.byId("hrPersonnelAreaList").clearSelection()}if(e.employeeGroup){this.byId("employeeGroupList").clearSelection()}},handleRefYearChange:function(e){this.resetOnRefYearChange();let t=e.getSource().getSelectedKey();l=t+"-01-01"},oFilter:function(){return new n({filters:[new n("startDate",i.LE,l),new n("endDate",i.GE,l)],and:true})},oFilterSecond:function(){return new n({filters:[new n("effectiveStartDate",i.LE,l),new n("mdfSystemEffectiveEndDate",i.GE,l)],and:true})},onValueHelpDialogConfirm:function(e){let t=e.getParameter("selectedItems");let r="";if(e.getSource().getId().includes("orgUnitList")){r="orgUnitInput"}else if(e.getSource().getId().includes("jobList")){r="jobInput"}else if(e.getSource().getId().includes("groupList")){r="groupInput"}else if(e.getSource().getId().includes("departmentList")){r="departmentInput"}else if(e.getSource().getId().includes("hrPersonnelAreaList")){r="hrPersonnelAreaInput"}else if(e.getSource().getId().includes("employeeGroupList")){r="employeeGroupInput"}let n=this.byId(r);if(!t){n.resetProperty("value");return}let i=[];for(let e=0;e<t.length;e++){i.push(t[e].getTitle())}n.setValue(i.toString())},orgUnitValueHelp:function(){let e=this.getView();if(!this.orgUnitHelpDialog){this.orgUnitHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.orgUnitValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this.orgUnitHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("orgUnitList").getBinding("items");t.filter(this.oFilter());e.open()}}.bind(this))},jobValueHelp:function(){let e=this.getView();if(!this._jobValueHelpDialog){this._jobValueHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.jobValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this._jobValueHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("jobList").getBinding("items");t.filter(this.oFilter());e.open()}}.bind(this))},groupValueHelp:function(){let e=this.getView();if(!this._groupHelpDialog){this._groupHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.groupValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this._groupHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("groupList").getBinding("items");t.filter(this.oFilter());e.open()}}.bind(this))},departmentValueHelp:function(){let e=this.getView();if(!this._departmentHelpDialog){this._departmentHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.departmentValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this._departmentHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("departmentList").getBinding("items");t.filter(this.oFilter());e.open()}}.bind(this))},hrPersonnelAreaValueHelp:function(){let e=this.getView();if(!this._hrPersonnelAreaValueHelpDialog){this._hrPersonnelAreaValueHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.hrPersonnelAreaValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this._hrPersonnelAreaValueHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("hrPersonnelAreaList").getBinding("items");t.filter(this.oFilterSecond());e.open()}}.bind(this))},employeeGroupValueHelp:function(){let e=this.getView();if(!this._employeeGroupValueHelpDialog){this._employeeGroupValueHelpDialog=o.load({id:e.getId(),name:"qa.com.qelng.pcui5.paycomponentsui5.view.employeeGroupValueHelp",controller:this}).then(function(t){e.addDependent(t);t._searchField.setVisible(false);return t}.bind(this))}this._employeeGroupValueHelpDialog.then(function(e){if(l==""){r.warning(this.getResourceBundle().getText("selectReferenceYear"))}else{let t=this.byId("employeeGroupList").getBinding("items");t.filter(this.oFilterSecond());e.open()}}.bind(this))},onExecute:function(){let e=this.getView().getModel().getData().healthCardForm;if(!this.validateEmail(this.splitFunction(e.adminEmail))){r.error(this.getResourceBundle().getText("correctEmail"));return}else if(!this.onSubmitCheck()){let t=this.getModel("pcModel").bindContext("/exectue(...)");t.setParameter("payComponent",this.convertPcToObject(e.payComponent));t.setParameter("referenceYear",parseInt(e.referenceYear));t.setParameter("userIds",this.splitFunction(e.userId));t.setParameter("foJobs",this.convertToJobsObject(e.job));t.setParameter("departments",this.convertToDepartmentsObject(e.department));t.setParameter("groups",this.convertToDepartmentsObject(e.group));t.setParameter("orgUnits",this.convertToOrgUnitsObject(e.organizationalUnit));t.setParameter("HRPersonnelArea",this.convertToHrPObject(e.hrPersonnelArea));t.setParameter("custEmployeeGroup",this.convertToHrPObject(e.employeeGroup));t.setParameter("emails",this.splitFunction(e.adminEmail));t.setParameter("simulationMode",e.simulationMode);t.execute().then(function(){r.success(this.getResourceBundle().getText("dataSent"));this.defaultHealthCardFormBinding()}.bind(this),function(e){r.error(e.message)}.bind(this)).then(function(){}.bind(this))}else{r.error(this.getResourceBundle().getText("mandatoryFields"))}},convertPcToObject:function(e){const t=e.split("_#");const r={ID:t[0],name:t[1],code:t[2]};return r},splitFunction:function(e){if(e==""){return[]}else{return e.split(",").map(e=>e.trim()).filter(e=>e!=="")}},convertToJobsObject:function(e){if(e==""){return[]}else{const t=e.split(",").map(e=>{const t=e.match(/(.*) \((\w+)\)$/);return{externalCode:t[2],custName:t[1]}});return t}},convertToDepartmentsObject:function(e){if(e==""){return[]}else{const t=e.split(",").map(e=>{const t=e.match(/(.*) \((\w+)\)$/);return{custExternalcode:t[2],name_defaultValue:t[1]}});return t}},convertToOrgUnitsObject:function(e){if(e==""){return[]}else{const t=e.split(",").map(e=>{const t=e.match(/(.*) \((\w+)\)$/);return{externalCode:t[2],orgunit:t[1]}});return t}},convertToHrPObject:function(e){if(e==""){return[]}else{const t=e.split(",").map(e=>{const t=e.match(/(.*) \((\w+)\)$/);return{externalCode:t[2],externalName:t[1]}});return t}},validateEmail:function(e){if(e){const t=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,11})+$/;return e.every(e=>t.test(e))}else{return true}},onSubmitCheck:function(){let e=this.byId("pcSelect"),t=this.byId("referenceYearSelect");let r=false;if(e.getValue().length<1){e.setValueState("Error");e.setValueStateText(this.getResourceBundle().getText("cannotBeEmpty"));r=true}else{e.setValueState("None");r=false}if(t.getValue().length<1){t.setValueState("Error");t.setValueStateText(this.getResourceBundle().getText("cannotBeEmpty"));r=true}else{t.setValueState("None");r=false}return r},onPressExecLogs:function(){this.getRouter().navTo("RouteExecutionLogs")}})});
//# sourceMappingURL=HealthCardForm.controller.js.map